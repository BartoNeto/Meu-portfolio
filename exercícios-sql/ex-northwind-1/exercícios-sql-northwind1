-- Pergunta 1: [Selecione o nome do contato (C: ContactName) e o telefone (C: Phone) de todos os clientes (T: Customers) que moram em Londres.]

select ContactName, Phone 
from Customers 
where City = 'London';


-- Pergunta 2: [ Mostre todos os produtos (T: Products) que estão com o estoque (C: UnitsInStock) zerado, ordenados pelo nome do produto em ordem alfabética (C: ProductName).]

select ProductName, UnitsInStock 
from Products 
where UnitsInStock = 0 
order by ProductName;


-- Pergunta 3: [Liste todos os pedidos (T: Orders) que foram feitos no mês de maio de 1997. Ordene os resultados pela data do pedido (C: OrderDate), do mais recente para o mais antigo.]

select OrderID, OrderDate 
from Orders 
where OrderDate between '1997-05-01 00:00:00' and '1997-05-31 23:59:59' 
order by OrderDate desc;


-- Pergunta 4: [Identifique os 5 produtos mais caros da loja. A consulta deve retornar o nome do produto (C: ProductName) e o seu preço (C: UnitPrice).]

select top 5 ProductName, UnitPrice 
from Products 
order by UnitPrice desc;


-- Pergunta 5: [Encontre todos os funcionários (T: Employees) que foram contratados (C: HireDate) antes do ano de 1993 e que moram nos EUA (C: Country = 'USA').]

select EmployeeID, HireDate, Country  
from Employees 
where HireDate < '1993-01-01' 
  and Country = 'USA';


-- Pergunta 6: [Quantos produtos ao todo são fornecidos pelo fornecedor (T: Supplier) de ID = 1?]

select count(*) as QuantidadeProdutos 
from Products 
where SupplierID = 1;


-- Pergunta 7: [Qual é o preço médio de todos os produtos cadastrados na tabela T: Products? Dê um nome (alias) para a coluna de resultado como PrecoMedio.]

select avg(UnitPrice) as PrecoMedio 
from Products;


-- Pergunta 8: [Crie uma consulta que mostre a quantidade de clientes existentes em cada país (C: Country).]

select Country, count(*) as Quantidade 
from Customers 
group by Country;


-- Pergunta 9: [Calcule o valor total de itens em estoque (C: UnitsInStock) para cada categoria de produto (C: CategoryID). A consulta deve mostrar o C: CategoryID e a soma total.]

select CategoryID, sum(UnitsInStock * UnitPrice) as SomaTotal 
from Products 
group by CategoryID;


-- Pergunta 10: [Liste todos os países que possuem mais de 7 clientes. A consulta deve mostrar o país e a contagem de clientes.]

select Country, count(*) as TotalClientes 
from Customers 
group by Country 
having count(*) > 7;


-- Pergunta 11: [Mostre o C: ProductID e o valor total vendido (calculado como C: UnitPrice * C: Quantity) para cada produto na tabela T: Order Details. Liste apenas os produtos cujo valor total vendido ultrapasse $50.000 e ordene do maior para o menor valor.]

select ProductID, sum(UnitPrice * Quantity) as ValorTotalVendido 
from [Order Details] 
group by ProductID 
having sum(UnitPrice * Quantity) > 50000 
order by ValorTotalVendido desc;


-- Pergunta 12: [Crie uma consulta que retorne todas as cidades (C: City) únicas para as quais já foram enviados pedidos (T: Orders).]

select distinct ShipCity 
from Orders;


-- Pergunta 13: [Liste o nome de todos os produtos (T: Products) que são da categoria 'Beverages'. (Dica: primeiro, use uma subconsulta para encontrar o C: CategoryID de 'Beverages' na tabela T: Categories).]

select ProductName 
from Products 
where CategoryID in (
    select CategoryID 
    from Categories 
    where CategoryName = 'Beverages'
);


-- Pergunta 14: [Mostre todos os produtos cujo preço unitário (C: UnitPrice) é maior que o preço médio de todos os produtos.]

select ProductName, UnitPrice 
from Products 
where UnitPrice > (
    select avg(UnitPrice) 
    from Products
);


-- Pergunta 15: [Insira uma nova transportadora (T: Shipper) na sua tabela T: Shippers_Copia. O nome da empresa (C: CompanyName) deve ser "Loggi" e o telefone (C: Phone) "(11) 99999-9999".]

insert into Shippers_Copia (CompanyName, Phone) 
values ('Loggi', '(11) 99999-9999');


-- Pergunta 16: [O telefone da "Loggi" mudou. Atualize o registro na tabela T: Shippers_Copia para o novo telefone "(11) 88888-8888".]

update Shippers_Copia 
set Phone = '(11) 88888-8888' 
where CompanyName = 'Loggi';


-- Pergunta 17: [Exclua a transportadora chamada "Speedy Express" da sua tabela T: Shippers_Copia.]

delete from Shippers_Copia 
where CompanyName = 'Speedy Express';


-- Pergunta 18: [Criação de Tabela (CREATE TABLE): Crie uma nova tabela chamada T: Auditoria com as seguintes colunas: C: LogID, C: NomeTabela, C: DataModificacao.]

create table Auditoria (
    LogID int,
    NomeTabela varchar(100),
    DataModificacao datetime
);


-- Pergunta 19: [Adição de Constraints: Recrie a tabela T: Auditoria adicionando as restrições: PRIMARY KEY, NOT NULL e DEFAULT.]

drop table if exists Auditoria;

create table Auditoria (
    LogID int primary key,
    NomeTabela varchar(100) not null,
    DataModificacao datetime not null default getdate()
);


-- Pergunta 20: [Alteração de Tabela (ALTER TABLE): Adicione uma nova coluna na tabela T: Auditoria chamada C: Usuario do tipo VARCHAR(50). Em seguida, remova esta mesma coluna da tabela.]

alter table Auditoria 
add Usuario varchar(50);

alter table Auditoria 
drop column Usuario;
